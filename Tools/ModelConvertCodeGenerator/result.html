<h1 id='3d系统交互接口'>3D系统交互接口</h1>
<p>3D系统分为人员定位系统和三维模型展示系统，与其交换数据的接口，包括区域和设备、SIS数据等信息的输出。</p>
<p>root path: /api</p>
<p>如无特殊说明，接口都是基于HTTP以 Restful 形式提供，获取信息用Get，新增或复杂查询用Post，修改用Put，删除用Delete。</p>
<p>接口一览：</p>
<table>
<thead>
<tr>
<th>功能</th>
<th>url</th>
<th>协议</th>
<th>调用方</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>获取人员列表</td>
<td>/api/users</td>
<td>HTTP Get</td>
<td>3D可视化</td>
<td></td>
</tr>
<tr>
<td>获取组织架构</td>
<td>/api/org</td>
<td>HTTP Get</td>
<td>3D可视化</td>
<td></td>
</tr>
<tr>
<td>获取区域列表</td>
<td>/api/zones</td>
<td>HTTP Get</td>
<td>3D可视化</td>
<td>暂不实现分页</td>
</tr>
<tr>
<td>获取区域信息</td>
<td>/api/zones/{id}</td>
<td>HTTP Get</td>
<td>3D可视化</td>
<td></td>
</tr>
<tr>
<td>获取区域的子区域</td>
<td>/api/zones/{id}/children</td>
<td>HTTP Get</td>
<td>3D可视化</td>
<td></td>
</tr>
<tr>
<td>获取设备列表</td>
<td>/api/devices</td>
<td>HTTP Get</td>
<td>3D可视化</td>
<td></td>
</tr>
<tr>
<td>获取设备信息</td>
<td>/api/devices/{id}</td>
<td>HTTP Get</td>
<td>3D可视化</td>
<td></td>
</tr>
<tr>
<td>获取设备下操作历史</td>
<td>/api/devices/{id}/actions</td>
<td>HTTP Get</td>
<td>3D可视化</td>
<td>如门禁刷卡记录</td>
</tr>
<tr>
<td>获取门禁卡列表</td>
<td>/api/cards</td>
<td>HTTP Get</td>
<td>3D可视化</td>
<td></td>
</tr>
<tr>
<td>获取门禁卡详细信息</td>
<td>/api/cards/{id}</td>
<td>HTTP Get</td>
<td>3D可视化</td>
<td>预留</td>
</tr>
<tr>
<td>获取门禁卡刷卡历史信息</td>
<td>/api/cards/{id}/actions</td>
<td>HTTP Get</td>
<td>3D可视化</td>
<td>预留</td>
</tr>
<tr>
<td>获取区域下设备列表</td>
<td>/api/zones/{id}/devices</td>
<td>HTTP Get</td>
<td>3D可视化</td>
<td></td>
</tr>
<tr>
<td>获取区域下物资列表</td>
<td>/api/zones/{id}/materials</td>
<td>HTTP Get</td>
<td>3D可视化</td>
<td>预留，暂不实现</td>
</tr>
<tr>
<td>摄像头视频播放</td>
<td></td>
<td></td>
<td></td>
<td>待定</td>
</tr>
<tr>
<td>获取两票列表</td>
<td>/api/tickets</td>
<td>HTTP Get</td>
<td>3D可视化</td>
<td></td>
</tr>
<tr>
<td>获取两票信息</td>
<td>/api/tickets/{id}</td>
<td>HTTP Get</td>
<td>3D可视化</td>
<td>预留</td>
</tr>
<tr>
<td>获取点巡检路线</td>
<td></td>
<td></td>
<td></td>
<td>待定，等热工院</td>
</tr>
<tr>
<td>获取点巡检详情</td>
<td></td>
<td></td>
<td></td>
<td>同上</td>
</tr>
<tr>
<td>获取报警事件列表</td>
<td>/api/events</td>
<td>HTTP Get</td>
<td>3D可视化</td>
<td></td>
</tr>
<tr>
<td>获取实时SIS数据</td>
<td>/api/rt/sis</td>
<td>HTTP Get</td>
<td>3D可视化</td>
<td></td>
</tr>
<tr>
<td>获取实时报警事件</td>
<td>/api/rt/events</td>
<td>HTTP Get</td>
<td>3D可视化</td>
<td></td>
</tr>
<tr>
<td>通用</td>
<td></td>
<td></td>
<td></td>
</tr>
</tbody>
</table>
<h1 id='人员'>人员</h1>
<h2 id='获取人员列表'>获取人员列表</h2>
<p>获取用户列表数据，由3D系统拉取。</p>
<h3 id='path'>path</h3>
<p>  users</p>
<h3 id='认证'>认证</h3>
<p>请参考通用认证章节</p>
<h3 id='method'>method</h3>
<p> GET</p>
<h3 id='params'>params</h3>
<p>参数参照通用参数。</p>
<h3 id='返回'>返回</h3>
<p>请参考通用返回消息。</p>
<p>人员信息json，字段包括但不限于：标识、姓名、性别、邮箱、电话、状态等。</p>
<p>人员字段：</p>
<table>
<thead>
<tr>
<th>字段</th>
<th>名称</th>
<th>类型</th>
<th>取值</th>
<th>可选</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>id</td>
<td>标识</td>
<td>int</td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>name</td>
<td>姓名</td>
<td>string</td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>gender</td>
<td>性别</td>
<td>int</td>
<td>字典：性别</td>
<td>√</td>
<td>0 未知<br />1 男<br />2 女<br /></td>
</tr>
<tr>
<td>email</td>
<td>邮箱</td>
<td>string</td>
<td></td>
<td>√</td>
<td></td>
</tr>
<tr>
<td>phone</td>
<td>电话</td>
<td>string</td>
<td></td>
<td>√</td>
<td></td>
</tr>
<tr>
<td>mobile</td>
<td>手机</td>
<td>string</td>
<td></td>
<td>√</td>
<td></td>
</tr>
<tr>
<td>enabled</td>
<td>是否启用</td>
<td>bool</td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>dept_name</td>
<td>部门名称</td>
<td>string</td>
<td></td>
<td>√</td>
</tr>
</tbody>
</table>
<h3 id='示例'>示例</h3>
<p>请求url：</p>
<pre><code class='lang-'>http://&lt;host&gt;:&lt;port&gt;/users
</code></pre>
<p>返回示例：</p>
<pre><code class='lang-'>{
    &quot;total&quot;: 1，
    &quot;msg&quot;: &quot;ok&quot;，
    &quot;data&quot;: [
      {
        &quot;id&quot;: 1, 
        &quot;name&quot;： &quot;张三&quot;, 
        &quot;gender&quot;： 1, 
        &quot;email&quot;: &quot;test@test.com&quot;,
        &quot;mobile&quot;: &quot;13800138000&quot;,
        &quot;enabled&quot;: true,
        &quot;dept_name&quot;: &quot;检修部&quot;
        ...,
      }，
      ...
    ]
}
</code></pre>
<h2 id='获取组织架构'>获取组织架构</h2>
<p>获取组织架构数据，由3D系统拉取。</p>
<h3 id='path'>path</h3>
<p>  org</p>
<h3 id='认证'>认证</h3>
<p>请参考通用认证章节</p>
<h3 id='method'>method</h3>
<p> GET</p>
<h3 id='params'>params</h3>
<p>参数参照通用参数。</p>
<h3 id='返回'>返回</h3>
<p>请参考通用返回消息。</p>
<p>组织架构信息json，字段包括但不限于：标识、名称、父级标识、说明、类型等。</p>
<p>字段：</p>
<table>
<thead>
<tr>
<th>字段</th>
<th>名称</th>
<th>类型</th>
<th>取值</th>
<th>可选</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>id</td>
<td>标识</td>
<td>int</td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>name</td>
<td>姓名</td>
<td>string</td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>parent_id</td>
<td>父部门ID</td>
<td>int</td>
<td></td>
<td></td>
<td>顶级部门为0</td>
</tr>
<tr>
<td>type</td>
<td>类型</td>
<td>int</td>
<td></td>
<td></td>
<td>0 本厂；1 外委单位</td>
</tr>
<tr>
<td>description</td>
<td>说明</td>
<td>string</td>
<td></td>
<td>√</td>
</tr>
</tbody>
</table>
<h3 id='示例'>示例</h3>
<p>请求url：</p>
<pre><code class='lang-'>http://&lt;host&gt;:&lt;port&gt;/api/org
</code></pre>
<p>返回示例：</p>
<pre><code class='lang-'>{
    &quot;total&quot;: 1，
    &quot;msg&quot;: &quot;ok&quot;，
    &quot;data&quot;: [
      {
        &quot;id&quot;: 1, 
        &quot;name&quot;： &quot;四会热电&quot;, 
        &quot;parent_id&quot;： 0, 
        &quot;type&quot;: 0,
        ...,
      }，
      ...
    ]
}
</code></pre>
<h1 id='区域-设备'>区域、设备</h1>
<h2 id='获取区域列表'>获取区域列表</h2>
<p>获取区域列表，由3D可视化模块拉取。</p>
<h3 id='path'>path</h3>
<p>  zones</p>
<h3 id='认证'>认证</h3>
<p>请参考通用认证章节</p>
<h3 id='method'>method</h3>
<p> GET</p>
<h3 id='params'>params</h3>
<p>参数参照通用参数。（暂不实现分页功能）</p>
<p>Query参数</p>
<ul>
<li>struct: 返回的数据格式，LIST/TREE，默认为TREE</li>
</ul>
<h3 id='返回'>返回</h3>
<p>请参考通用返回消息。</p>
<p>区域信息json，区域字段包括但不限于：标识、名称、KKS码、说明等。</p>
<p>区域字段：</p>
<table>
<thead>
<tr>
<th>字段</th>
<th>名称</th>
<th>类型</th>
<th>取值</th>
<th>可选</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>id</td>
<td>标识</td>
<td>int</td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>name</td>
<td>名称</td>
<td>string</td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>kks</td>
<td>KKS编码</td>
<td>string</td>
<td></td>
<td>√</td>
<td></td>
</tr>
<tr>
<td>description</td>
<td>说明</td>
<td>string</td>
<td></td>
<td>√</td>
<td></td>
</tr>
<tr>
<td>x</td>
<td>X坐标</td>
<td>float</td>
<td></td>
<td>√</td>
<td></td>
</tr>
<tr>
<td>y</td>
<td>y坐标</td>
<td>float</td>
<td></td>
<td>√</td>
<td></td>
</tr>
<tr>
<td>z</td>
<td>z坐标</td>
<td>float</td>
<td></td>
<td>√</td>
<td></td>
</tr>
<tr>
<td>parent_id</td>
<td>父ID</td>
<td>int</td>
<td></td>
<td>√</td>
<td>主厂区为null</td>
</tr>
<tr>
<td>path</td>
<td>级联关系</td>
<td>string</td>
<td></td>
<td>√</td>
<td>用于多层级数据的快速查询，内容为从根节点ID开始的所有父子关系，以/分隔，形如：[[parent.parent.parent.id]parent.parent.id/]parent.id</td>
</tr>
</tbody>
</table>
<h3 id='示例'>示例</h3>
<p>请求url：</p>
<pre><code class='lang-'>http://&lt;host&gt;:&lt;port&gt;/api/zones
</code></pre>
<p>返回示例：</p>
<pre><code class='lang-'>{ // tree
        &quot;id&quot;: 1, 
        &quot;name&quot;： &quot;主厂区&quot;, 
        &quot;kks&quot;： &quot;K012345678&quot;, 
        ...
        &quot;children&quot;: [
            {
                &quot;id&quot;: 2,
                ...
            }
        ]
}
</code></pre>
<pre><code class='lang-'>{ // list
    &quot;total&quot;: 3,
    &quot;msg&quot;: &quot;ok&quot;,
    &quot;data&quot;: [
      {
        &quot;id&quot;: 1, 
        &quot;name&quot;： &quot;主厂区&quot;, 
        &quot;kks&quot;： &quot;K012345678&quot;, 
        ...
      },
      ...
    ]
}
</code></pre>
<h2 id='获取区域信息'>获取区域信息</h2>
<p>获取单个区域数据，由3D可视化模块拉取。</p>
<h3 id='path'>path</h3>
<p>  zones/{id}</p>
<p>  id 为区域标识。</p>
<font color=red><strong>注：考虑支持kks，以kks:{kks}的形式？下面有kks的同此。</strong></font>


<h3 id='认证'>认证</h3>
<p>请参考通用认证章节</p>
<h3 id='method'>method</h3>
<p> GET</p>
<h3 id='params'>params</h3>
<p>参数请参考通用参数章节。</p>
<p>Query params：</p>
<table>
<thead>
<tr>
<th>字段</th>
<th>名称</th>
<th>类型</th>
<th>取值</th>
<th>可选</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>view</td>
<td>视图掩码</td>
<td>int</td>
<td></td>
<td></td>
<td>要附加内容时将掩码加上，如要请求时顺便返回子区域和设备，则 view = 1 + 2，即 view = 3。0 默认；1 附加子区域； 2 附加关联设备；4 附加（危险）物资</td>
</tr>
</tbody>
</table>
<h3 id='返回'>返回</h3>
<p>请参考通用返回消息。</p>
<p>区域信息json，区域字段包括但不限于：标识、名称、KKS码、说明等。</p>
<p>设备字段：</p>
<table>
<thead>
<tr>
<th>字段</th>
<th>名称</th>
<th>类型</th>
<th>取值</th>
<th>可选</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>id</td>
<td>标识</td>
<td>int</td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>name</td>
<td>名称</td>
<td>string</td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>kks</td>
<td>KKS编码</td>
<td>string</td>
<td>√</td>
<td></td>
<td></td>
</tr>
<tr>
<td>description</td>
<td>说明</td>
<td>string</td>
<td>√</td>
<td></td>
<td></td>
</tr>
<tr>
<td>...</td>
<td>...</td>
<td>...</td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>zones</td>
<td>子区域</td>
<td>json</td>
<td>√</td>
<td></td>
<td>列表</td>
</tr>
<tr>
<td>devices</td>
<td>关联设备</td>
<td>json</td>
<td>√</td>
<td></td>
<td>列表</td>
</tr>
<tr>
<td>materials</td>
<td>（危险）物资</td>
<td>json</td>
<td>√</td>
<td></td>
<td>暂不实现</td>
</tr>
</tbody>
</table>
<h3 id='示例'>示例</h3>
<p>请求url：</p>
<pre><code class='lang-'>http://&lt;host&gt;:&lt;port&gt;/api/zones?view=7
</code></pre>
<p>返回示例：</p>
<pre><code class='lang-'>{
    &quot;total&quot;: 3,
    &quot;msg&quot;: &quot;ok&quot;,
    &quot;data&quot;: [
      {
        &quot;id&quot;: 1, 
        &quot;name&quot;： &quot;主厂区&quot;, 
        &quot;kks&quot;： &quot;K012345678&quot;, 
        &quot;zones&quot;: [...], // 子区域列表，数据结构同区域
        &quot;devices&quot;: [...],  // 直接关联的设备列表，数据结构请参考设备信息接口
        &quot;materials&quot;: [...], // （危险）物资列表，数据结构请参考物资信息接口
        ...
      }
    ]

}
</code></pre>
<h2 id='获取设备列表'>获取设备列表</h2>
<p>获取设备数据，由3D系统拉取。</p>
<h3 id='path'>path</h3>
<p>  devices</p>
<h3 id='认证'>认证</h3>
<p>同上</p>
<h3 id='method'>method</h3>
<p> GET</p>
<h3 id='params'>params</h3>
<p>参数请参考通用参数章节。</p>
<p>Query params：</p>
<table>
<thead>
<tr>
<th>字段</th>
<th>名称</th>
<th>类型</th>
<th>取值</th>
<th>可选</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>types</td>
<td>分类</td>
<td>string</td>
<td>字典：设备类型</td>
<td>√</td>
<td>逗号分隔，只查询指定的设备类型</td>
</tr>
<tr>
<td>code</td>
<td>编码</td>
<td>string</td>
<td></td>
<td>√</td>
<td></td>
</tr>
<tr>
<td>name</td>
<td>名称</td>
<td>string</td>
<td></td>
<td>√</td>
</tr>
</tbody>
</table>
<h3 id='返回'>返回</h3>
<p>请参考通用返回消息。</p>
<p>设备信息json，设备字段包括但不限于：序号、设备分类、KKS码、设备名称、状态等。</p>
<p>设备字段：</p>
<table>
<thead>
<tr>
<th>字段</th>
<th>名称</th>
<th>类型</th>
<th>取值</th>
<th>可选</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>id</td>
<td>标识</td>
<td>int</td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>code</td>
<td>编码</td>
<td>string</td>
<td></td>
<td>√</td>
<td></td>
</tr>
<tr>
<td>kks</td>
<td>KKS编码</td>
<td>string</td>
<td></td>
<td>√</td>
<td></td>
</tr>
<tr>
<td>name</td>
<td>名称</td>
<td>string</td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>type</td>
<td>分类</td>
<td>int</td>
<td>字典：设备类型</td>
<td></td>
<td>请参考通用字典章节</td>
</tr>
<tr>
<td>state</td>
<td>状态</td>
<td>int</td>
<td>字典：设备状态</td>
<td>√</td>
<td></td>
</tr>
<tr>
<td>running_state</td>
<td>运行状态</td>
<td>int</td>
<td>字典：设备运行状态</td>
<td>√</td>
<td></td>
</tr>
<tr>
<td>placed</td>
<td>是否已指定点位</td>
<td>bool</td>
<td></td>
<td>√</td>
<td></td>
</tr>
<tr>
<td>raw_id</td>
<td>原始ID</td>
<td>string</td>
<td></td>
<td>√</td>
<td>设备在其他系统的ID</td>
</tr>
</tbody>
</table>
<h3 id='示例'>示例</h3>
<p>请求url：</p>
<pre><code class='lang-'>http://&lt;host&gt;:&lt;port&gt;/devices
</code></pre>
<p>返回示例：</p>
<pre><code class='lang-'>{
    &quot;total&quot;: 3,
    &quot;msg&quot;: &quot;ok&quot;,
    &quot;data&quot;: [
      {
        &quot;id&quot;: 1, 
        &quot;name&quot;： &quot;摄像头001&quot;, 
        &quot;kks&quot;： &quot;K012345678001&quot;, 
        ... 
      }
    ]
}
</code></pre>
<h2 id='获取设备信息'>获取设备信息</h2>
<p>获取设备数据，由3D系统拉取。</p>
<h3 id='path'>path</h3>
<p>  devices/{id}</p>
<p>  id为设备标识。</p>
<h3 id='认证'>认证</h3>
<p>同上</p>
<h3 id='method'>method</h3>
<p> GET</p>
<h3 id='params'>params</h3>
<p>无</p>
<h3 id='返回'>返回</h3>
<p>请参考通用返回消息。</p>
<p>设备信息json，设备字段包括但不限于：序号、设备分类、KKS码、设备名称、状态等。</p>
<p>设备字段：</p>
<table>
<thead>
<tr>
<th>字段</th>
<th>名称</th>
<th>类型</th>
<th>取值</th>
<th>可选</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>id</td>
<td>标识</td>
<td>int</td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>code</td>
<td>编码</td>
<td>string</td>
<td></td>
<td>√</td>
<td></td>
</tr>
<tr>
<td>kks</td>
<td>KKS编码</td>
<td>string</td>
<td></td>
<td>√</td>
<td></td>
</tr>
<tr>
<td>name</td>
<td>名称</td>
<td>string</td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>type</td>
<td>分类</td>
<td>int</td>
<td>字典：设备类型</td>
<td></td>
<td>请参考通用字典章节</td>
</tr>
<tr>
<td>state</td>
<td>状态</td>
<td>int</td>
<td>字典：设备状态</td>
<td>√</td>
<td></td>
</tr>
<tr>
<td>running_state</td>
<td>运行状态</td>
<td>int</td>
<td>字典：设备运行状态</td>
<td>√</td>
<td></td>
</tr>
<tr>
<td>placed</td>
<td>是否已指定点位</td>
<td>bool</td>
<td></td>
<td>√</td>
<td></td>
</tr>
<tr>
<td>raw_id</td>
<td>原始ID</td>
<td>string</td>
<td></td>
<td>√</td>
<td>设备在其他系统的ID</td>
</tr>
</tbody>
</table>
<h3 id='示例'>示例</h3>
<p>请求url：</p>
<pre><code class='lang-'>http://&lt;host&gt;:&lt;port&gt;/devices/1
</code></pre>
<p>返回示例：</p>
<pre><code class='lang-'>{
    &quot;id&quot;: 1, 
    &quot;name&quot;： &quot;摄像头001&quot;, 
    &quot;kks&quot;： &quot;K012345678001&quot;, 
    ... 
}
</code></pre>
<h2 id='获取设备操作历史'>获取设备操作历史</h2>
<p>获取设备操作历史数据，如门禁的刷卡历史，由3D系统拉取。</p>
<h3 id='path'>path</h3>
<p>  devices/{id}/actions</p>
<p>  id为设备标识。</p>
<h3 id='认证'>认证</h3>
<p>同上</p>
<h3 id='method'>method</h3>
<p> GET</p>
<h3 id='params'>params</h3>
<p>Query params：</p>
<table>
<thead>
<tr>
<th>字段</th>
<th>名称</th>
<th>类型</th>
<th>取值</th>
<th>可选</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>begin_date</td>
<td>开始日期</td>
<td>string</td>
<td></td>
<td>√</td>
<td>格式：yyyyMMdd<br />默认为当天</td>
</tr>
<tr>
<td>end_date</td>
<td>结束日期</td>
<td>string</td>
<td></td>
<td>√</td>
<td>跨度最大一个月</td>
</tr>
</tbody>
</table>
<h3 id='返回'>返回</h3>
<p>请参考通用返回消息。</p>
<p>操作历史json，字段包括但不限于：序号、门禁卡号、操作时间、操作状态/结果码、操作说明等。</p>
<p>设备字段：</p>
<table>
<thead>
<tr>
<th>字段</th>
<th>名称</th>
<th>类型</th>
<th>取值</th>
<th>可选</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>id</td>
<td>标识</td>
<td>int</td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>device_id</td>
<td>设备标识</td>
<td>int</td>
<td></td>
<td>√</td>
<td></td>
</tr>
<tr>
<td>card_code</td>
<td>门禁卡号</td>
<td>string</td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>t</td>
<td>操作时间</td>
<td>long</td>
<td></td>
<td>√</td>
<td>EPOCH，单位：秒</td>
</tr>
<tr>
<td>code</td>
<td>结果码</td>
<td>int</td>
<td>字典：操作状态</td>
<td></td>
<td>0 成功<br />其他为失败<br /></td>
</tr>
<tr>
<td>description</td>
<td>说明</td>
<td>string</td>
<td></td>
<td>√</td>
<td>请参考通用字典章节</td>
</tr>
</tbody>
</table>
<h3 id='示例'>示例</h3>
<p>请求url：</p>
<pre><code class='lang-'>http://&lt;host&gt;:&lt;port&gt;/devices/1/actions
</code></pre>
<p>返回示例：</p>
<pre><code class='lang-'>{
    &quot;total&quot;: 1，
    &quot;msg&quot;: &quot;ok&quot;，
    &quot;data&quot;: [
      {
        &quot;id&quot;: 1, 
        &quot;card_code&quot;： &quot;12345678&quot;, 
        &quot;t&quot;： 1535323470, 
        &quot;code&quot;: 0,
        ...,
      }，
      ...
    ]
}
</code></pre>
<h2 id='获取门禁卡列表'>获取门禁卡列表</h2>
<p>获取门禁卡列表，由3D系统拉取。</p>
<h3 id='path'>path</h3>
<p>  cards</p>
<h3 id='认证'>认证</h3>
<p>同上</p>
<h3 id='method'>method</h3>
<p> GET</p>
<h3 id='params'>params</h3>
<p>参数请参考通用参数章节。</p>
<h3 id='返回'>返回</h3>
<p>请参考通用返回消息。</p>
<p>门禁卡json，字段包括但不限于：序号、门禁卡号、操作时间、操作状态/结果码、操作说明等。</p>
<p>设备字段：</p>
<table>
<thead>
<tr>
<th>字段</th>
<th>名称</th>
<th>类型</th>
<th>取值</th>
<th>可选</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>id</td>
<td>标识</td>
<td>int</td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>code</td>
<td>门禁卡号</td>
<td>string</td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>emp_id</td>
<td>当前绑定人员标识</td>
<td>int</td>
<td></td>
<td>√</td>
<td></td>
</tr>
<tr>
<td>state</td>
<td>卡状态</td>
<td>int</td>
<td>字典：卡状态</td>
<td></td>
<td>0 未激活<br />1 激活/使用中<br />2 挂失/暂停使用<br /></td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
</tbody>
</table>
<h3 id='示例'>示例</h3>
<p>请求url：</p>
<pre><code class='lang-'>http://&lt;host&gt;:&lt;port&gt;/cards
</code></pre>
<p>返回示例：</p>
<pre><code class='lang-'>{
    &quot;total&quot;: 1，
    &quot;msg&quot;: &quot;ok&quot;，
    &quot;data&quot;: [
      {
        &quot;id&quot;: 1, 
        &quot;code&quot;： &quot;12345678&quot;, 
        &quot;emp_id&quot;： 1, 
        &quot;state&quot;: 0,
        ...,
      }，
      ...
    ]
}
</code></pre>
<h2 id='获取门禁卡详情-预留-'>获取门禁卡详情（预留）</h2>
<p>获取门禁卡详情，由3D系统拉取。</p>
<p>门禁卡内容比较少，暂不需要单独接口。</p>
<h3 id='path'>path</h3>
<p>  cards/{id}</p>
<p>其他类似获取详情接口。</p>
<h2 id='获取门禁卡操作历史'>获取门禁卡操作历史</h2>
<p>获取门禁卡操作历史数据，即刷卡历史，由3D系统拉取。</p>
<h3 id='path'>path</h3>
<p>  cards/{id}/actions</p>
<p>  id为门禁卡标识。</p>
<h3 id='认证'>认证</h3>
<p>同上</p>
<h3 id='method'>method</h3>
<p> GET</p>
<h3 id='params'>params</h3>
<p>Query params：</p>
<table>
<thead>
<tr>
<th>字段</th>
<th>名称</th>
<th>类型</th>
<th>取值</th>
<th>可选</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>begin_date</td>
<td>开始日期</td>
<td>string</td>
<td></td>
<td>√</td>
<td>格式：yyyyMMdd<br />默认为当天</td>
</tr>
<tr>
<td>end_date</td>
<td>结束日期</td>
<td>string</td>
<td></td>
<td>√</td>
<td>跨度最大一个月</td>
</tr>
</tbody>
</table>
<h3 id='返回'>返回</h3>
<p>请参考通用返回消息。</p>
<p>门禁刷卡历史json，字段包括但不限于：序号、门禁设备号、门禁卡号、操作时间、操作状态/结果码、操作说明等。</p>
<p>设备字段：</p>
<table>
<thead>
<tr>
<th>字段</th>
<th>名称</th>
<th>类型</th>
<th>取值</th>
<th>可选</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>id</td>
<td>标识</td>
<td>int</td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>device_id</td>
<td>门禁设备标识</td>
<td>int</td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>card_code</td>
<td>门禁卡号</td>
<td>string</td>
<td></td>
<td>√</td>
<td></td>
</tr>
<tr>
<td>t</td>
<td>操作时间</td>
<td>long</td>
<td></td>
<td>√</td>
<td>EPOCH，单位：秒</td>
</tr>
<tr>
<td>code</td>
<td>结果码</td>
<td>int</td>
<td>字典：操作状态</td>
<td></td>
<td>0 成功<br />其他为失败<br /></td>
</tr>
<tr>
<td>description</td>
<td>说明</td>
<td>string</td>
<td></td>
<td>√</td>
<td>请参考通用字典章节</td>
</tr>
</tbody>
</table>
<h3 id='示例'>示例</h3>
<p>请求url：</p>
<pre><code class='lang-'>http://&lt;host&gt;:&lt;port&gt;/cards/1/actions
</code></pre>
<p>返回示例：</p>
<pre><code class='lang-'>{
    &quot;total&quot;: 1，
    &quot;msg&quot;: &quot;ok&quot;，
    &quot;data&quot;: [
      {
        &quot;id&quot;: 1, 
        &quot;device_id&quot;: 1,
        &quot;card_code&quot;： &quot;12345678&quot;, 
        &quot;t&quot;： 1535323470, 
        &quot;code&quot;: 0,
        ...,
      }，
      ...
    ]
}
</code></pre>
<h2 id='获取区域下设备列表'>获取区域下设备列表</h2>
<p>获取区域下设备列表，由3D系统拉取。</p>
<h3 id='path'>path</h3>
<p>  zones/{id}/devices</p>
<p>id 为区域标识。</p>
<h3 id='认证'>认证</h3>
<p>同上。</p>
<h3 id='method'>method</h3>
<p> GET</p>
<h3 id='params'>params</h3>
<p>无</p>
<h3 id='返回'>返回</h3>
<p>请参考通用返回消息。</p>
<h3 id='示例'>示例</h3>
<p>请求url：</p>
<pre><code class='lang-'>http://&lt;host&gt;:&lt;port&gt;/api/zones/1/devices
</code></pre>
<p>返回示例：</p>
<pre><code class='lang-'>{
    &quot;total&quot;: 1，
    &quot;msg&quot;: &quot;ok&quot;，
    &quot;data&quot;: [
      {
        &quot;id&quot;: 1, 
        &quot;name&quot;： &quot;摄像头001&quot;, 
        &quot;kks&quot;： &quot;K012345678001&quot;, 
        ...
      }，
      ...
    ]
}
</code></pre>
<h2 id='获取两票列表'>获取两票列表</h2>
<p>获取两票列表数据，由3D系统拉取。</p>
<h3 id='path'>path</h3>
<p>  tickets</p>
<h3 id='认证'>认证</h3>
<p>同上</p>
<h3 id='method'>method</h3>
<p> GET</p>
<h3 id='params'>params</h3>
<p>Query params：</p>
<table>
<thead>
<tr>
<th>字段</th>
<th>名称</th>
<th>类型</th>
<th>取值</th>
<th>可选</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>type</td>
<td>两票类型</td>
<td>int</td>
<td>字典：两票类型</td>
<td></td>
<td>1 操作票<br />2 工作票</td>
</tr>
</tbody>
</table>
<h3 id='返回'>返回</h3>
<p>请参考通用返回消息。</p>
<p>两票信息json，字段包括但不限于：序号、设备分类、KKS码、设备名称、状态等。</p>
<p>设备字段：</p>
<table>
<thead>
<tr>
<th>字段</th>
<th>名称</th>
<th>类型</th>
<th>取值</th>
<th>可选</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>id</td>
<td>标识</td>
<td>int</td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>code</td>
<td>票号</td>
<td>string</td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>type</td>
<td>类型</td>
<td>int</td>
<td>字典：两票类型</td>
<td></td>
<td></td>
</tr>
<tr>
<td>state</td>
<td>状态</td>
<td>int</td>
<td>字典：两票状态</td>
<td>√</td>
<td>待定</td>
</tr>
<tr>
<td>worker_ids</td>
<td>涉及人员标识列表</td>
<td>json</td>
<td>数组</td>
<td>√</td>
<td></td>
</tr>
<tr>
<td>zone_ids</td>
<td>涉及区域标识列表</td>
<td>json</td>
<td>数组</td>
<td>√</td>
<td></td>
</tr>
<tr>
<td>detail</td>
<td>原始信息</td>
<td>json</td>
<td></td>
<td></td>
<td>ERP中的两票数据</td>
</tr>
</tbody>
</table>
<h3 id='示例'>示例</h3>
<p>请求url：</p>
<pre><code class='lang-'>http://&lt;host&gt;:&lt;port&gt;/tickets
</code></pre>
<p>返回示例：</p>
<pre><code class='lang-'>{
    &quot;total&quot;: 1，
    &quot;msg&quot;: &quot;ok&quot;，
    &quot;data&quot;: [
      {
        &quot;id&quot;: 1, 
        &quot;code&quot;： &quot;12345678&quot;, 
        &quot;type&quot;： 1, 
        &quot;state&quot;: 0,
        &quot;worker_ids&quot;: [1,2,3],
        ...,
      }，
      ...
    ]
}
</code></pre>
<h2 id='获取两票信息'>获取两票信息</h2>
<p>获取两票的详情，由3D系统拉取。</p>
<h3 id='path'>path</h3>
<p>  tickets/{id}</p>
<p>  id为两票标识。</p>
<h3 id='认证'>认证</h3>
<p>同上</p>
<h3 id='method'>method</h3>
<p> GET</p>
<h3 id='params'>params</h3>
<p>Query params：</p>
<table>
<thead>
<tr>
<th>字段</th>
<th>名称</th>
<th>类型</th>
<th>取值</th>
<th>可选</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>begin_date</td>
<td>开始日期</td>
<td>string</td>
<td></td>
<td>√</td>
<td>格式：yyyyMMdd<br />默认为当天</td>
</tr>
<tr>
<td>end_date</td>
<td>结束日期</td>
<td>string</td>
<td></td>
<td>√</td>
<td>跨度最大一个月</td>
</tr>
</tbody>
</table>
<h3 id='返回'>返回</h3>
<p>请参考通用返回消息。</p>
<p>字段请参考上节，增加详情字段：</p>
<table>
<thead>
<tr>
<th>字段</th>
<th>名称</th>
<th>类型</th>
<th>取值</th>
<th>可选</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>detail</td>
<td>原始信息标识</td>
<td>json</td>
<td></td>
<td></td>
<td>ERP中的两票数据</td>
</tr>
</tbody>
</table>
<h3 id='示例'>示例</h3>
<p>无</p>
<h2 id='获取报警事件列表'>获取报警事件列表</h2>
<p>获取报警历史数据，由3D系统拉取。</p>
<h3 id='path'>path</h3>
<p>  events</p>
<h3 id='认证'>认证</h3>
<p>同上</p>
<h3 id='method'>method</h3>
<p> GET</p>
<h3 id='params'>params</h3>
<p>Query params：</p>
<table>
<thead>
<tr>
<th>字段</th>
<th>名称</th>
<th>类型</th>
<th>取值</th>
<th>可选</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>src</td>
<td>来源</td>
<td>int</td>
<td>字典：报警事件来源</td>
<td>√</td>
<td></td>
</tr>
<tr>
<td>level</td>
<td>级别</td>
<td>int</td>
<td>字典：报警事件级别</td>
<td>√</td>
<td></td>
</tr>
<tr>
<td>begin_t</td>
<td>开始时间戳</td>
<td>long</td>
<td></td>
<td>√</td>
<td>EPOCH，到秒</td>
</tr>
<tr>
<td>end_t</td>
<td>结束时间戳</td>
<td>long</td>
<td></td>
<td>√</td>
<td>跨度最大一个月</td>
</tr>
</tbody>
</table>
<h3 id='返回'>返回</h3>
<p>请参考通用返回消息。</p>
<p>报警事件字段请参考实时报警章节。</p>
<h3 id='示例'>示例</h3>
<p>请求url：</p>
<pre><code class='lang-'>http://&lt;host&gt;:&lt;port&gt;/api/events
</code></pre>
<p>返回示例：</p>
<pre><code class='lang-'>请参考实时报警章节
</code></pre>
<h1 id='实时数据'>实时数据</h1>
<h2 id='获取sis传感数据'>获取SIS传感数据</h2>
<p>获取sis数据，由3D系统拉取。</p>
<h3 id='path'>path</h3>
<p>  rt/{kks}</p>
<p>kks为设备KKS码，多个码之间以半角逗号&quot;,&quot;分隔。</p>
<p>如需要获取某一大型设备下相关传感器的数据，由调用方挑选KKS列表。</p>
<h3 id='认证'>认证</h3>
<p>同上。</p>
<h3 id='method'>method</h3>
<p> GET</p>
<h3 id='params'>params</h3>
<p>无</p>
<h3 id='返回'>返回</h3>
<p>与请求KKS对应的数据列表。</p>
<p>字段：</p>
<table>
<thead>
<tr>
<th>字段</th>
<th>名称</th>
<th>类型</th>
<th>取值</th>
<th>可选</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>kks</td>
<td>KKS编码</td>
<td>string</td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>value</td>
<td>值</td>
<td>string</td>
<td></td>
<td>√</td>
<td>没找到数据时为null</td>
</tr>
</tbody>
</table>
<h3 id='示例'>示例</h3>
<p>请求url：</p>
<pre><code class='lang-'>http://&lt;host&gt;:&lt;port&gt;/api/rt/sis/k01,k02
</code></pre>
<p>返回示例：</p>
<pre><code class='lang-'>{
    &quot;total&quot;: 1，
    &quot;msg&quot;: &quot;ok&quot;，
    &quot;data&quot;: [
      {
        &quot;kks&quot;: &quot;k01&quot;, 
        &quot;value&quot;： &quot;10&quot;
      }，
      ...
    ]
}
</code></pre>
<h2 id='获取报警事件'>获取报警事件</h2>
<p>获取各子系统（安防、消防、设备等）的报警事件数据，由3D系统拉取。</p>
<h3 id='path'>path</h3>
<p>  rt/events</p>
<h3 id='认证'>认证</h3>
<p>同上。</p>
<h3 id='method'>method</h3>
<p> GET</p>
<h3 id='params'>params</h3>
<p>无</p>
<h3 id='返回'>返回</h3>
<p>与请求KKS对应的数据列表。</p>
<p>报警信息字段：</p>
<table>
<thead>
<tr>
<th>字段</th>
<th>名称</th>
<th>类型</th>
<th>取值</th>
<th>可选</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>id</td>
<td>标识</td>
<td>int</td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>title</td>
<td>标题</td>
<td>string</td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>msg</td>
<td>内容</td>
<td>string</td>
<td></td>
<td>√</td>
<td></td>
</tr>
<tr>
<td>level</td>
<td>级别</td>
<td>int</td>
<td>字典：报警事件级别</td>
<td>√</td>
<td></td>
</tr>
<tr>
<td>code</td>
<td>代码</td>
<td>string</td>
<td></td>
<td>√</td>
<td>各系统上报的原始编码</td>
</tr>
<tr>
<td>src</td>
<td>来源</td>
<td>string</td>
<td>字典：报警事件来源</td>
<td>√</td>
<td></td>
</tr>
<tr>
<td>device_id</td>
<td>设备ID</td>
<td>int</td>
<td></td>
<td>√</td>
<td></td>
</tr>
<tr>
<td>device_desc</td>
<td>设备说明</td>
<td>string</td>
<td></td>
<td>√</td>
<td></td>
</tr>
<tr>
<td>t</td>
<td>时间戳</td>
<td>long</td>
<td></td>
<td></td>
<td>EPOCH，到秒</td>
</tr>
</tbody>
</table>
<h3 id='示例'>示例</h3>
<p>请求url：</p>
<pre><code class='lang-'>http://&lt;host&gt;:&lt;port&gt;/api/rt/events
</code></pre>
<p>返回示例：</p>
<pre><code class='lang-'>{
    &quot;total&quot;: 1，
    &quot;msg&quot;: &quot;ok&quot;，
    &quot;data&quot;: [
      {
        &quot;id&quot;: 1, 
        &quot;title&quot;： &quot;电磁门未关闭&quot;,
        &quot;msg&quot;： &quot;电磁门未关闭&quot;,
        ...
      }，
      ...
    ]
}
</code></pre>
<h1 id='通用'>通用</h1>
<h2 id='路径参数-path-parameters-'>路径参数（Path Parameters）</h2>
<p>在url路径中的动态参数。</p>
<table>
<thead>
<tr>
<th>字段</th>
<th>名称</th>
<th>类型</th>
<th>取值</th>
<th>可选</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>id</td>
<td>标识</td>
<td>int, string</td>
<td></td>
<td>√</td>
<td>为请求资源的标识</td>
</tr>
</tbody>
</table>
<h2 id='请求参数-query-parameters-'>请求参数（Query Parameters）</h2>
<p>请求参数，键值对形式，主要是用于分页、过滤。</p>
<table>
<thead>
<tr>
<th>字段</th>
<th>名称</th>
<th>类型</th>
<th>取值</th>
<th>可选</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>offset</td>
<td>记录偏移</td>
<td>int</td>
<td></td>
<td>√</td>
<td>用于分页，默认为 0</td>
</tr>
<tr>
<td>limit</td>
<td>限制条数</td>
<td>int</td>
<td></td>
<td>√</td>
<td>用于分页，默认为 100</td>
</tr>
<tr>
<td>order</td>
<td>排序字段</td>
<td>json</td>
<td></td>
<td>√</td>
<td></td>
</tr>
<tr>
<td>filter</td>
<td>过滤条件</td>
<td>json</td>
<td></td>
<td>√</td>
<td></td>
</tr>
<tr>
<td>fields</td>
<td>返回字段</td>
<td>json</td>
<td></td>
<td>√</td>
<td></td>
</tr>
<tr>
<td>full</td>
<td>是否全量</td>
<td>bool</td>
<td></td>
<td>√</td>
<td>默认为true</td>
</tr>
</tbody>
</table>
<h2 id='返回消息'>返回消息</h2>
<p>状态码为20x表示成功，其他为异常。</p>
<p>返回消息体json。</p>
<table>
<thead>
<tr>
<th>字段</th>
<th>名称</th>
<th>类型</th>
<th>取值</th>
<th>可选</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>total</td>
<td>总数量</td>
<td>int</td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>msg</td>
<td>消息内容</td>
<td>string</td>
<td></td>
<td></td>
<td>正常时为ok，否则为错误内容</td>
</tr>
<tr>
<td>data</td>
<td>数据</td>
<td>json</td>
<td></td>
<td></td>
<td>按照对象schema</td>
</tr>
</tbody>
</table>
<h2 id='认证'>认证</h2>
<p>对于数据使用有限制的接口，要求进行接入用户认证，用户及其权限由各平台独自管理。</p>
<p>添加请求头（HTTP Header） Authorization，值为 Bearer &quot; + token，token由平台第三方应用管理提供。</p>
<p>示例：</p>
<pre><code class='lang-'>Bearer  eyJhbGciOiJIUzI1NiJ9.eyJzdWIiOiI5OTk5OTk5OTkiLCJyb2xlIjoiYXBwIiwiZXhwIjoxODIxMTczODgzfQ.IscevTI_zYpfbZrolmHilu1Jh-tUc3HLdSBOa23Qz6g
</code></pre>
<h2 id='字典'>字典</h2>
<h3 id='设备类型'>设备类型</h3>
<p>暂定。以后可能根据KKS的定义做变更。</p>
<ul>
<li>100 固定设备<ul>
<li>101 生产设备</li>
<li>102 摄像头<ul>
<li>1021 枪机</li>
<li>1022 球机</li>
<li>1023 半球</li>
</ul>
</li>
<li>103 门禁<ul>
<li>1031 单向</li>
<li>1032 双向</li>
</ul>
</li>
<li>104 消防设备</li>
<li>105 危化品</li>
<li>106 定位基站</li>
<li>107 巡检点</li>
<li>108 停车位？</li>
</ul>
</li>
<li>200 移动设备<ul>
<li>201 一卡通</li>
<li>202 人员定位终端</li>
<li>203 移动终端</li>
</ul>
</li>
</ul>
<h3 id='设备运行状态'>设备运行状态</h3>
<ul>
<li>0 正常</li>
<li>1 离线</li>
<li>2 报警</li>
</ul>
<h3 id='设备状态'>设备状态</h3>
<ul>
<li>0 正常</li>
<li>1 维修中</li>
<li>2 已报失</li>
<li>9 已作废</li>
</ul>
<h3 id='报警事件级别'>报警事件级别</h3>
<ul>
<li>0 未定</li>
<li>1 低</li>
<li>2 中</li>
<li>3 高</li>
</ul>
<h3 id='报警事件来源'>报警事件来源</h3>
<ul>
<li>0 未知</li>
<li>1 视频监控</li>
<li>2 门禁</li>
<li>3 消防</li>
<li>11 SIS</li>
<li>12 人员定位</li>
</ul>
